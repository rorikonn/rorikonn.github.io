<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>GAS系统-输入 • Hexo</title><meta name="description" content="GAS系统-输入 - John Doe"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Hexo"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="Hexo">Hexo</a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">GAS系统-输入</h1><div class="post-info"><a></a>2025-08-01</div><div class="post-content"><p>GAS提供了一个可扩展的输入绑定机制，支持了包括输入绑定、输入同步、Confirm&#x2F;Cancel等机制。默认实现中只提供了基础框架，并没有默认的接入流程，所以需要一定的定制开发才能完全使用。</p>
<hr>
<h3 id="1-关联GA与InputID"><a href="#1-关联GA与InputID" class="headerlink" title="1. 关联GA与InputID"></a><strong>1. 关联GA与InputID</strong></h3><p>通过在<code>GiveAbility</code> 时，给 <code>FGameplayAbilitySpec</code> 指定 <code>InputID</code> 来实现。在UE的实例代码中，<code>UGameplayAbilitySet</code> 中包含了这个信息，其中的 <code>FGameplayAbilityBindInfo</code> 中包含了一个GA类与一个InputID。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>()  </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FGameplayAbilityBindInfo</span>  </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">GENERATED_USTRUCT_BODY</span>()  </span><br><span class="line">     </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, Category = BindInfo)  </span><br><span class="line">    TEnumAsByte&lt;EGameplayAbilityInputBinds::Type&gt; Command = EGameplayAbilityInputBinds::Ability1;</span><br><span class="line">      </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, Category = BindInfo)  </span><br><span class="line">    TSubclassOf&lt;UGameplayAbility&gt; GameplayAbilityClass;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在 <code>GiveAbilities</code> 函数中，InputID会作为构造函数参数保存在 <code>FGameplayAbilitySpec</code> 中，这里就完成了GA与InputID的绑定。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UGameplayAbilitySet::GiveAbilities</span><span class="params">(UAbilitySystemComponent* ASC)</span> <span class="type">const</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> FGameplayAbilityBindInfo&amp; BindInfo : Abilities)  </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (BindInfo.GameplayAbilityClass)  </span><br><span class="line">        &#123;</span><br><span class="line">            ASC-&gt;<span class="built_in">GiveAbility</span>(<span class="built_in">FGameplayAbilitySpec</span>(</span><br><span class="line">                BindInfo.GameplayAbilityClass,</span><br><span class="line">                <span class="number">1</span>,</span><br><span class="line">                (int32)BindInfo.Command)</span><br><span class="line">            );  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里InputID是int类型是为了方便策划在蓝图中定义自己的枚举来标识输入，蓝图枚举可以直接作为int参数传递到C++中。</p>
<p>在实际生产实现中，我们可以自己实现一套关联机制，只要最终我们能够将一个InputID保存在关联的 <code>FGameplayAbilitySpec</code> 中即可。</p>
<hr>
<h3 id="2-AbilitySystemComponent-与输入组件绑定"><a href="#2-AbilitySystemComponent-与输入组件绑定" class="headerlink" title="2. AbilitySystemComponent 与输入组件绑定"></a><strong>2. <code>AbilitySystemComponent</code> 与输入组件绑定</strong></h3><p>官方示例的实现在 <code>UAbilitySystemComponent::BindAbilityActivationToInputComponent</code> 中。这一步是让 <code>UAbilitySystemComponent</code> 监听所有依赖的输入事件，并以InputID调用 <code>UAbilitySystemComponent::AbilityLocalInputPressed</code> 与 <code>UAbilitySystemComponent::AbilityLocalInputReleased</code>。</p>
<p>比较特别的是 <code>GenericConfirmInputID</code> 与 <code>GenericCancelInputID</code>。这两个成员是用于需要二次确认的GA，比如释放时触发范围框选，需再次确认释放或者取消。这两个成员变量对应确认与取消的InputID。</p>
<p>同样，实际生产过程中我们可以自己重写这个机制。因为这个示例实现使用的是旧的输入系统，而现在大多使用[[增强输入系统|增强输入系统]]。自己实现这个机制只需要保证：</p>
<ul>
<li><p>在输入按下和抬起时，调用 <code>UAbilitySystemComponent::AbilityLocalInputPressed</code> 和 <code>UAbilitySystemComponent::AbilityLocalInputReleased</code> 并将InputID作为参数。</p>
</li>
<li><p>Confirm 和 Cancel 按钮按下时，调用 <code>UAbilitySystemComponent::LocalInputConfirm</code> 和 <code>UAbilitySystemComponent::LocalInputCancel</code>。</p>
</li>
<li><p>或者设置 <code>GenericConfirmInputID</code> 与 <code>GenericCancelInputID</code>。这种方式和上面的绑定选一种即可。</p>
</li>
</ul>
<hr>
<h3 id="3-输入触发逻辑"><a href="#3-输入触发逻辑" class="headerlink" title="3. 输入触发逻辑"></a><strong>3. 输入触发逻辑</strong></h3><p>收到按下输入后：</p>
<ul>
<li><p>首先判断 <code>GenericConfirmInputID</code> 或 <code>GenericCancelInputID</code> 是否有设置回调，如果有则只触发 Confirm 或 Cancel。</p>
</li>
<li><p>否则遍历所有InputID相同的 <code>FGameplayAbilitySpec</code>，如果其已经在运行则调用 <code>InputPressed</code>，并且发送 ReplicatedEvent - <code>EAbilityGenericReplicatedEvent::InputPressed</code>。</p>
</li>
<li><p>如果GA没有在运行，则调用 <code>TryActivateAbility</code></p>
</li>
</ul>
<p>收到抬起输入则只会触发 <code>InputReleased</code>，并且发送 ReplicatedEvent - <code>EAbilityGenericReplicatedEvent::InputReleased</code>。</p>
<hr>
<h3 id="4-输入事件的同步"><a href="#4-输入事件的同步" class="headerlink" title="4. 输入事件的同步"></a><strong>4. 输入事件的同步</strong></h3></div></article></div></main><footer><div class="paginator"><a class="prev" href="/2025/08/01/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/Gameplay%20Ability%20System/GAS%E7%B3%BB%E7%BB%9F-%E7%B4%A2%E6%95%8C/">prev</a><a class="next" href="/2025/08/01/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/Gameplay%20Ability%20System/GAS%E7%B3%BB%E7%BB%9F-%E9%A2%84%E6%B5%8B/">next</a></div><div class="copyright"><p>&copy; 2025 <a href="https://github.com/rorikonn">Jimmy Zou</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>